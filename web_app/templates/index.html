<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional CSV converter for Follow Up Boss to Sierra CRM. Secure, fast, and reliable data conversion.">
    <title>FUB to Sierra CSV Converter | Professional Data Conversion</title>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Professional Header -->
        <header class="site-header">
            <nav class="nav-wrapper">
                <div class="nav-content">
                    <a href="/" class="site-logo">
                        <span>üîÑ</span>
                        <span>FUB Converter</span>
                    </a>
                    <ul class="nav-menu">
                        <li><a href="/" class="nav-link active">Converter</a></li>
                        <li><a href="/privacy" class="nav-link">Privacy</a></li>
                        <li><a href="/terms" class="nav-link">Terms</a></li>
                        <li><a href="/refund-policy" class="nav-link">Refund Policy</a></li>
                        <li>
                            <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark/light mode">
                                üåô
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <h1 class="headline-large hero-title">Transform Your FUB Data</h1>
                <p class="hero-subtitle">
                    Seamlessly convert Follow Up Boss exports to Sierra CRM format.<br>
                    Instant processing. Immediate download. Zero data retention.
                </p>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Error Message -->
            <div id="errorMessage" class="error-message" role="alert"></div>

            <!-- Upload Zone -->
            <section class="card">
                <div id="uploadZone" class="upload-zone" role="button" tabindex="0" aria-label="Upload CSV file">
                    <div class="upload-icon">üìÅ</div>
                    <h2>Drop your FUB CSV file here</h2>
                    <p>or click to browse ‚Ä¢ Maximum 50MB</p>
                    <input type="file" id="fileInput" accept=".csv" aria-label="File input">
                </div>
            </section>

            <!-- Column Mapping Section -->
            <section id="mappingSection" class="card hidden">
                <h2 class="headline-small">Column Mapping</h2>
                <p class="body-large" style="margin-bottom: 32px;">
                    Select the fields you want to include in your Sierra CRM export
                </p>
                
                <div class="columns-grid">
                    <div class="column-card">
                        <h3>üë§ Contact Information</h3>
                        <div id="contactMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>üìç Location Details</h3>
                        <div id="locationMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>üìù Notes & Tags</h3>
                        <div id="notesMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>üìÖ Dates & Timeline</h3>
                        <div id="datesMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>üíº Professional Info</h3>
                        <div id="professionalMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>üì± Social Media</h3>
                        <div id="socialMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>üè† Property Search</h3>
                        <div id="propertyMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>üè∑Ô∏è MLS & Listings</h3>
                        <div id="mlsMappings" class="column-mapping"></div>
                    </div>
                    <div class="column-card">
                        <h3>‚öôÔ∏è Custom Fields</h3>
                        <div id="customMappings" class="column-mapping"></div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <button id="convertBtn" class="btn btn-primary">
                        Convert to Sierra Format
                    </button>
                </div>
            </section>

            <!-- Loading Indicator -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p style="margin-top: 20px; font-weight: 500;">Converting your file...</p>
            </div>

            <!-- Console Output -->
            <section id="consoleSection" class="card hidden">
                <h2 class="headline-small">Conversion Log</h2>
                <div id="consoleOutput" class="console-output"></div>
            </section>

            <!-- Preview Section -->
            <section id="previewSection" class="card preview-section">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; flex-wrap: wrap; gap: 20px;">
                    <div>
                        <h2 class="headline-small" style="margin-bottom: 8px;">Data Preview</h2>
                        <p class="caption">First rows of your converted data</p>
                    </div>
                    
                    <!-- Payment Notice Inline -->
                    <div id="paymentNoticeInline" class="payment-notice" style="display: none;">
                        <h3>Ready to Download?</h3>
                        <p style="margin: 8px 0 16px;">Complete payment to access your files</p>
                        <a href="{{ payment_link }}" target="_blank" class="payment-link">
                            Complete Payment
                        </a>
                    </div>
                </div>
                
                <p class="body-medium" style="color: var(--text-secondary); margin-bottom: 20px;">
                    ‚ö†Ô∏è This is a preview only. Complete payment to download the full, high-quality CSV files with all data.
                </p>
                
                <div class="preview-container">
                    <div class="preview-watermark">
                        <div class="preview-table-wrapper">
                            <table id="previewTable" class="preview-table"></table>
                        </div>
                    </div>
                </div>
                
                <p class="caption" style="margin-top: 16px; text-align: center;">
                    üí° Scroll horizontally and vertically to see all columns and rows
                </p>
            </section>

            <!-- Download Section -->
            <section id="downloadSection" class="card glass hidden">
                <div style="text-align: center; margin-bottom: 24px;">
                    <h2 class="headline-small text-success">‚úÖ Files Ready for Download</h2>
                    <p class="body-large" style="margin-top: 12px; color: var(--text-secondary);">
                        Your conversion is complete! Download your Sierra CRM-formatted files below.
                    </p>
                </div>
                
                <!-- Payment Card - Only shown after conversion -->
                <div id="paymentCard" style="display: none; background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-indigo) 100%); color: white; padding: 24px; border-radius: 16px; max-width: 420px; margin: 0 auto 32px; box-shadow: 0 8px 24px rgba(175, 82, 222, 0.25); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 12px;">üí≥</div>
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 8px;">Ready to Download?</h3>
                    <p style="font-size: 0.9375rem; margin-bottom: 16px; opacity: 0.95; line-height: 1.5;">Complete payment to access your converted files</p>
                    <a href="{{ payment_link }}" target="_blank" class="payment-link" style="background: white; color: var(--accent-purple); padding: 12px 20px; border-radius: 10px; text-decoration: none; font-weight: 600; display: inline-block; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); transition: all 0.2s ease;">
                        Complete Payment ‚Üí
                    </a>
                </div>
                
                <div style="background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-blue) 100%); color: white; padding: 20px 24px; border-radius: 14px; margin: 24px 0; font-weight: 500; box-shadow: 0 4px 16px rgba(90, 200, 250, 0.2);">
                    <strong style="font-size: 1.125rem;">‚ö†Ô∏è IMPORTANT: Download Now!</strong><br>
                    <p style="margin: 8px 0 0 0; line-height: 1.6;">
                        Your files are only available during this browser session. We do NOT store any data on our servers. 
                        If you close this window or navigate away, your files will be permanently lost.
                    </p>
                </div>
                <div id="downloadFiles" class="download-files"></div>
                <p class="caption" style="margin-top: 24px;">
                    ‚ö†Ô∏è <strong>Download immediately!</strong> Files are only available during your current session and are NOT stored on our servers.
                </p>
                
                <!-- Convert Another File Dropdown -->
                <details style="margin-top: 48px; padding-top: 32px; border-top: 1px solid var(--divider);">
                    <summary style="cursor: pointer; text-align: center; padding: 16px; font-weight: 600; color: var(--text-secondary); list-style: none; display: flex; align-items: center; justify-content: center; gap: 8px; transition: color 0.2s ease;">
                        <span style="font-size: 1.125rem;">‚öôÔ∏è Advanced Options</span>
                        <span style="font-size: 0.875rem; opacity: 0.7;">‚ñº</span>
                    </summary>
                    <div style="text-align: center; padding: 24px 0 16px;">
                        <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 0.9375rem;">
                            Starting a new conversion will permanently delete your current files.
                        </p>
                        <button id="convertAnotherBtn" class="btn btn-secondary">
                            üîÑ Convert Another File
                        </button>
                    </div>
                </details>
            </section>
        </main>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-grid">
                    <div class="footer-section">
                        <h4>Product</h4>
                        <ul class="footer-links">
                            <li><a href="/" class="footer-link">Converter Tool</a></li>
                            <li><a href="/#features" class="footer-link">Features</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Legal</h4>
                        <ul class="footer-links">
                            <li><a href="/terms" class="footer-link">Terms of Service</a></li>
                            <li><a href="/privacy" class="footer-link">Privacy Policy</a></li>
                            <li><a href="/refund-policy" class="footer-link">Refund Policy</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul class="footer-links">
                            <li><a href="mailto:support@example.com" class="footer-link">Contact Support</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>About</h4>
                        <ul class="footer-links">
                            <li><a href="/#" class="footer-link">How It Works</a></li>
                            <li><a href="/#" class="footer-link">Security</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p class="footer-copyright">
                        ¬© 2025 FUB to Sierra Converter. All rights reserved.
                    </p>
                    <ul class="footer-legal">
                        <li><a href="/privacy" class="footer-link">Privacy</a></li>
                        <li><a href="/terms" class="footer-link">Terms</a></li>
                        <li><a href="/refund-policy" class="footer-link">Refund Policy</a></li>
                    </ul>
                </div>
            </div>
        </footer>

        <!-- Warning Modal -->
        <div id="warningModal" class="modal">
            <div class="modal-content">
                <div style="text-align: center; margin-bottom: 24px; font-size: 64px;">‚ö†Ô∏è</div>
                <h2 style="color: var(--accent-red); text-align: center;">Warning: You Will Lose Your Files!</h2>
                <p style="font-size: 1.0625rem; line-height: 1.7; margin: 24px 0;">
                    Starting a new conversion will <strong>permanently delete</strong> your current download links.
                </p>
                <p style="font-size: 1.0625rem; line-height: 1.7; margin: 24px 0;">
                    <strong>Have you downloaded all your files?</strong>
                </p>
                <div style="background: var(--bg-tertiary); border-left: 4px solid var(--accent-red); border-radius: 8px; padding: 20px; margin: 24px 0;">
                    <p style="margin: 0; color: var(--accent-red); font-weight: 600;">
                        ‚ö†Ô∏è This action cannot be undone!
                    </p>
                </div>
                <div class="modal-actions">
                    <button id="cancelWarningBtn" class="btn btn-outlined">
                        Cancel - Keep Files
                    </button>
                    <button id="confirmWarningBtn" class="btn btn-danger">
                        Yes, I Downloaded Everything
                    </button>
                </div>
            </div>
        </div>

        <!-- Second Confirmation Modal -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div style="text-align: center; margin-bottom: 24px; font-size: 64px;">üõë</div>
                <h2 style="color: var(--accent-red); text-align: center;">Final Confirmation</h2>
                <p style="font-size: 1.125rem; font-weight: 600; line-height: 1.7; margin: 24px 0; text-align: center;">
                    Are you ABSOLUTELY SURE you want to start over?
                </p>
                <p style="font-size: 1.0625rem; line-height: 1.7; margin: 24px 0; color: var(--accent-red); text-align: center;">
                    Your current files will be <strong>DELETED PERMANENTLY</strong>.
                </p>
                <div class="modal-actions">
                    <button id="cancelConfirmBtn" class="btn btn-primary">
                        No, Keep My Files
                    </button>
                    <button id="finalConfirmBtn" class="btn btn-danger">
                        DELETE and Start Over
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pass Flask data to JavaScript -->
    <script>
        window.defaultMapping = {{ default_fub_cols | tojson }};
    </script>
    
    <!-- Main Application Script -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
